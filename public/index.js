!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Poci=e():t.Poci=e()}(this,(()=>(()=>{"use strict";var t={d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Init:()=>b});const n=(t,e)=>{const n=new Array(t.length);for(let o=0;o<t.length;o++)n[o]=e(t[o]);return n};class o{constructor(t,e,n){this.type=t,this.name=e,this.content=n}static element="Element";static props="Properties";static text="TextNode"}class r extends o{constructor(t,e,n){super(o.element,t,null),this.props=n,this.children=e}}class s extends o{constructor(t,e){super(o.props,t,e??"")}}class i extends o{constructor(t){super(o.text,"",t??"")}}function a(t){const e=n(Object.keys(t.attributes),(e=>{const n=t.attributes[e];return new s(n.nodeName,n.nodeValue)})),o=new r(t.tagName.toLocaleLowerCase(),[],e);for(const e of t.childNodes)o.children.push(e.nodeType===Node.TEXT_NODE?new i(e.nodeValue):a(e));return o}function l(t,e){const n=null==e,o=e.$$label===t.dataset.label,r=t.tagName.toLocaleLowerCase()===e.name;if(n||!o||!r)return a(t);const{attributes:s}=t,i=Object.values(s),{props:c}=e;for(const e of i){if(!1===(()=>{for(const t of c)if("data-label"!==e.nodeName&&null!==t&&t.name!==e.nodeName)return!1})())return a(t)}let d=0;for(const n of t.childNodes){n.nodeType===Node.TEXT_NODE||d>=e.children.length||(e.children[d]=l(n,e.children[d]),d++)}return e}class c extends Error{constructor(t,e){super(`[error] : ${t}<${e}>`),this.msg=t,this.type=e}static ParameterInvalid="ParameterNotValid";static ExpressionInvalid="ExpressionNotValid"}function d(t){if(t.type===o.text)return document.createTextNode(t.content);const e=document.createElement(t.name);for(const n of t.props)e.setAttribute(n.name,n.content);e.setAttribute("data-label",t.$$label);for(const n of t.children)n.type===o.element?e.appendChild(d(n)):e.appendChild(document.createTextNode(n.content));return e}const u=/^((\w+|\w+\[(\d+)\])(->)?)*$/,h=/^\w+$/,p=/^((\w+)\[(\d+)\])$/,f=/{{(.+?)}}/;function m(t,e){if(t=t.replace(/\s+/g,""),!u.test(t))throw new c(`${t} is not expression`,c.ExpressionInvalid);const n=t.split("->");let o={...e};for(const t of n)if(h.test(t)){if(!(-1!==Object.keys(o).indexOf(t)))throw new c(`${t} is not found`,c.ExpressionInvalid);o=o[t]}else{const[,,e,n]=p.exec(t),r=-1!==Object.keys(o).indexOf(e),s=Array.isArray(o[e]),i=o[e].length>n;if(!r||!s||!i)throw new c(`${t} is not found`,c.ExpressionInvalid);o=o[e][n]}return o}function O(t,e){for(;f.test(t);){const[,n]=f.exec(t),o=m(n,e);t=t.replace(f,o)}return t}function y(t,e){return(t=JSON.parse(JSON.stringify(t))).props=n(t.props,(t=>null===t?null:(t.content=O(t.content,e),t))),t.children=n(t.children,(t=>(t.type===o.text?t.content=O(t.content,e):t=y(t,e),t))),t}class b{#t;#e;#n;constructor(t,e={}){if(this.rootDOM=document.querySelector(t),null===this.rootDOM)throw new c("root is not found",c.ParameterInvalid);if("object"!=typeof e||null===e||Array.isArray(e))throw new c("data is not valid",c.ParameterInvalid);this.#e=a(this.rootDOM),this.#t=a(this.rootDOM),this.#n=e,this.data=e,this.render()}#o(t,e,n){for(const r in e.children){const s=e.children[r],i=t.children[r],a=n.childNodes[r];s.type===o.element?this.#o(i,s,a):s.type===o.text&&s.content!==i.content&&(a.nodeValue=s.content)}let r=0;for(const o of t.props){if(null==o)continue;const t=e.props[r];if(o.content!==t.content)return n.parentElement.replaceChild(d(e),n),!0;r++}}render(){const t=y(this.#e,this.#n);this.#o(this.#t,t,this.rootDOM),this.#t=t}set(t,e){this.#n[t]=e,this.data={...this.#n},this.render()}track(){this.#e=l(this.rootDOM,this.#e)}#r(t=this.rootDOM){t.removeAttribute("data-label","");for(let e=0;e<t.children.length;e++)this.#r(t.children[e])}pull(){this.#r(),this.rootSelector="",this.rootDOM=null,this.#e={},this.#t={},this.#n={},this.data={}}}return e})()));