!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Poci=t():e.Poci=t()}(this,(()=>(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Init:()=>w});const o=(e,t)=>{const o=new Array(e.length);for(let n=0;n<e.length;n++)o[n]=t(e[n]);return o};class n{constructor(e,t,o){this.type=e,this.name=t,this.content=o}static element="Element";static props="Properties";static text="TextNode"}class r extends n{constructor(e,t,o){super(n.element,e,null),this.props=o,this.children=t}}class s extends n{constructor(e,t){super(n.props,e,t??"")}}class i extends n{constructor(e){super(n.text,"",e??"")}}function l(e){const t=o(Object.keys(e.attributes),(t=>{const o=e.attributes[t];return new s(o.nodeName,o.nodeValue)})),n=new r(e.tagName.toLocaleLowerCase(),[],t);for(const t of e.childNodes)n.children.push(t.nodeType===Node.TEXT_NODE?new i(t.nodeValue):l(t));return n}function c(e,t){const o=null==t,n=e.tagName.toLocaleLowerCase()===t.name;if(o||!n)return l(e);const{attributes:r}=e,s=Object.values(r),{props:i}=t;for(const t of s){if(!1===(()=>{for(const e of i)if(e.name!==t.nodeName)return!1})())return l(e)}let d=0;for(const o of e.childNodes){o.nodeType===Node.TEXT_NODE||d>=t.children.length||(t.children[d]=c(o,t.children[d]),d++)}return t}class d extends Error{constructor(e,t){super(`[error] : ${e}<${t}>`),this.msg=e,this.type=t}static ParameterInvalid="ParameterNotValid";static HookExpressionInvalid="HookExpressionNotValid"}function a(e){if(e.type===n.text)return document.createTextNode(e.content);const t=document.createElement(e.name);for(const o of e.props)t.setAttribute(o.name,o.content);for(const o of e.children)t.appendChild(a(o));return t}const p=/^((\w+|\w+\[(\d+)\])(->)?)*$/,u=/^\w+$/,h=/^((\w+)\[(\d+)\])$/,f=/{{(.+?)}}/;function m(e,t){if(e=e.replace(/\s+/g,""),!p.test(e))throw new d(`${e} is not hook expression`,d.HookExpressionInvalid);const o=e.split("->");let n={...t};for(const e of o)if(u.test(e)){if(!(-1!==Object.keys(n).indexOf(e)))throw new d(`${e} is not found`,d.HookExpressionInvalid);n=n[e]}else{const[,,t,o]=h.exec(e),r=-1!==Object.keys(n).indexOf(t),s=Array.isArray(n[t]),i=n[t].length>o;if(!r||!s||!i)throw new d(`${e} is not found`,d.HookExpressionInvalid);n=n[t][o]}return n}function y(e,t){for(;f.test(e);){const[,o]=f.exec(e),n=m(o,t);e=e.replace(f,n)}return e}function x(e,t){return(e=JSON.parse(JSON.stringify(e))).props=o(e.props,(e=>null===e?null:(e.content=y(e.content,t),e))),e.children=o(e.children,(e=>(e.type===n.text?e.content=y(e.content,t):e=x(e,t),e))),e}class w{#e;#t;#o;constructor(e,t={}){if(this.root=document.querySelector(e),null===this.root||null===this.root)throw new d("root is not found",d.ParameterInvalid);if("object"!=typeof t||null===t||Array.isArray(t))throw new d("modelGroup is not valid",d.ParameterInvalid);this.#t=l(this.root),this.#e=l(this.root),this.#o=t,this.modelGroup=t,this.render()}#n(e,t,o){for(const r in t.children){const s=t.children[r],i=e.children[r],l=o.childNodes[r];s.type===n.element?this.#n(i,s,l):s.type===n.text&&s.content!==i.content&&(l.nodeValue=s.content)}for(const n in e.props){const r=e.props[n],s=t.props[n];if(r.content!==s.content)return o.parentElement.replaceChild(a(t),o),null}}render(){const e=x(this.#t,this.#o);this.#n(this.#e,e,this.root),this.#e=e}set(e,t){this.#o[e]=t,this.modelGroup={...this.#o},this.render()}track(){this.#t=c(this.root,this.#t)}pull(){this.root=null,this.#t=null,this.#e=null,this.#o=null,this.modelGroup=null}}return t})()));