!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Poci=e():t.Poci=e()}(this,(()=>(()=>{"use strict";var t={d:(e,o)=>{for(var r in o)t.o(o,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:o[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Init:()=>y});const o=(t,e)=>{const o=new Array(t.length);for(let r=0;r<t.length;r++)o[r]=e(t[r]);return o};class r{constructor(t,e,o){this.type=t,this.name=e,this.content=o}static element="Element";static props="Properties";static text="TextNode"}class n extends r{constructor(t,e,o,n){super(r.element,t,null),this.$$label=n,this.props=o,this.children=e}}class s extends r{constructor(t,e){super(r.props,t,e??"")}}class i extends r{constructor(t){super(r.text,"",t??"")}}function a(t){let e=((new Date).getTime()*(r=1,l=50,Math.floor(Math.random()*(l-r+1))+r)).toString(36);var r,l;const c=o(Object.keys(t.attributes),(o=>{const r=t.attributes[o];return"data-label"===r.nodeName?(e=r.nodeValue,null):new s(r.nodeName,r.nodeValue)})),d=new n(t.tagName.toLocaleLowerCase(),[],c,e);t.dataset.label=e;for(const e of t.childNodes)d.children.push(e.nodeType===Node.TEXT_NODE?new i(e.nodeValue):a(e));return d}function l(t,e){const o=null==e,r=e.$$label===t.dataset.label,n=t.tagName.toLocaleLowerCase()===e.name;if(o||!r||!n)return a(t);const{attributes:s}=t,i=Object.values(s),{props:c}=e;for(const e of i){if(!1===(()=>{for(const t of c)if("data-label"!==e.nodeName&&null!==t&&t.name!==e.nodeName)return!1})())return a(t)}let d=0;for(const o of t.childNodes){o.nodeType===Node.TEXT_NODE||d>=e.children.length||(e.children[d]=l(o,e.children[d]),d++)}return e}class c extends Error{constructor(t,e){super(`[error] : ${t}<${e}>`),this.msg=t,this.type=e}static ParameterInvalid="ParameterNotValid";static ExpressionInvalid="ExpressionNotValid"}function d(t){const e=document.createElement(t.name);for(const o of t.props)e.setAttribute(o.name,o.content);e.setAttribute("data-label",t.$$label);for(const o of t.children)o.type===r.element?e.appendChild(d(o)):e.appendChild(document.createTextNode(o.content));return e}const u=/^((\w+|\w+\[(\d+)\])(->)?)*$/,h=/^\w+$/,p=/^((\w+)\[(\d+)\])$/,f=/{{(.+?)}}/;function m(t,e){if(t=t.replace(/\s+/g,""),!u.test(t))throw new c(`${t} is not expression`,c.ExpressionInvalid);const o=t.split("->");let r={...e};for(const t of o)if(h.test(t)){if(!(-1!==Object.keys(r).indexOf(t)))throw new c(`${t} is not found`,c.ExpressionInvalid);r=r[t]}else{const[,,e,o]=p.exec(t),n=-1!==Object.keys(r).indexOf(e),s=Array.isArray(r[e]),i=r[e].length>o;if(!n||!s||!i)throw new c(`${t} is not found`,c.ExpressionInvalid);r=r[e][o]}return r}function O(t,e){for(;f.test(t);){const[,o]=f.exec(t),r=m(o,e);t=t.replace(f,r)}return t}function b(t,e){return(t=JSON.parse(JSON.stringify(t))).props=o(t.props,(t=>(t.content=O(t.content,e),t))),t.children=o(t.children,(t=>(t.type===r.text?t.content=O(t.content,e):t=b(t,e),t))),t}class y{#t;#e;#o;constructor(t,e={}){if(this.rootSelector=t,this.rootDOM=document.querySelector(t),null===this.rootDOM)throw new c("root is not found",c.ParameterInvalid);if("object"!=typeof e||null===e||Array.isArray(e))throw new c("data is not valid",c.ParameterInvalid);this.#e=a(this.rootDOM),this.#t=a(this.rootDOM),this.#o=e,this.data=e}set(t,e){this.#o[t]=e,this.data={...this.#o},this.#t=b(this.#e,this.#o),this.rootDOM.parentNode.replaceChild(d(this.#t),this.rootDOM),this.rootDOM=document.querySelector(this.rootSelector)}track(){this.#e=l(this.rootDOM,this.#e)}#r(t=this.rootDOM){t.removeAttribute("data-label","");for(let e=0;e<t.children.length;e++)this.#r(t.children[e])}pull(){this.#r(),this.rootSelector="",this.rootDOM=null,this.#e={},this.#t={},this.#o={},this.data={}}}return e})()));